---
title: "Final Project Presentation"
author: "Chad Huntebrinker"
date: "2024-12-13"
output: powerpoint_presentation
---

```{r setup, include=FALSE}
library(readxl)
library(leaps)
library(psych)
library(lmtest)

excel_data <- read_excel("market_share.xlsx")
```

# Introduction
- Goal: to predict market share of a food product
- Prediction will be done with assorted predictor variables
- Methods: Linear Regression model and assorted checks for validity

# What is Market Share?
- Percentage of total sales in an industry generated by a company
- Company product sold / total industry products sold x 100

# What are the predictor variables (part 1)
- There's two continuous predictor variables
  - price: average monthly price of a product
  - gnrpoints: Gross Nielson rating points

# What are the predictor variables (part 2)
- There are 4 discrete variables
  - discount: whether there was or wasn't a discount that month
  - promotion: whether there was or wasn't a promotion that month
  - month
  - year
  
# Individual Predictor and Response Variable Investigation
```{r echo=FALSE}
par(mfrow = c(2, 2))
boxplot(excel_data$price, xlab = "Price Boxplot", horizontal = TRUE)
boxplot(excel_data$gnrpoints, xlab = "Gross Nielson rating points Boxplot", horizontal = TRUE)
boxplot(excel_data$marketshare, xlab = "Market share Boxplot", horizontal = TRUE)
hist(excel_data$marketshare, main = "Market share Histogram", xlab = "Market share (in percentage)")
par(mfrow = c(1, 1))
```

# Multicollinearity
```{r echo=FALSE}
pairs.panels(excel_data[,-1], ellipses = FALSE, density = FALSE)
```

# Automatic Model Selection (part 1)
```{r echo=FALSE}
#Check to see what are the best three subsets
auto_model <- regsubsets(marketshare~price + gnrpoints + discount + promotion + year,
                 data=excel_data)
sum_of_auto_model <- summary(auto_model)

#Check Cp, R^2, and BIC
print("Cp:")
sum_of_auto_model$cp
print("R^2:")
sum_of_auto_model$rsq
print("BIC:")
sum_of_auto_model$bic
```

# Automatic Model Selection (part 1)
```{r echo=FALSE}
#Model 3 is our best model
sum_of_auto_model$which[3,]
#Thus, we will include price, discount and promotion

#Create a model with those three variables in it
final_model <- lm(marketshare~price + discount + promotion, data = excel_data)
```


# Final Checks on the Model (part 1)
```{r echo=FALSE}
#Check for outliers
#Check studentized residuals against the predicted values in the model
par(mfrow = c(1, 2))
plot(fitted(final_model), rstudent(final_model),
     col = "lightgreen", pch = 16,
     xlab = expression(hat(Y)),
     ylab = "Studentized Residuals",
     ylim = c(-5, 5), main = "(a)",
     cex.lab = 0.7, cex = 0.5)
abline(h = 0, lty = 2, lwd = 3,
       col = "darkgray")
abline(h = 3, lty = 3, lwd = 3,
       col = "darkgray")
abline(h = -3, lty = 3, lwd = 3,
       col = "darkgray")

#Cook's Distance
print("Value to use for Cook's Distance:")
pf(0.95, df1 = 3, df2 = 33)
cat("\n")
cat("\n")

cooksd <- cooks.distance(final_model)
plot(cooksd, pch = "*", cex.main = 0.7, main = "(b)",
     ylab = "Cooks distance", cex.lab = 0.7)
text(x = 1:length(cooksd) + 1, y = cooksd, labels = ifelse(cooksd > 0.5722362, names(cooksd), ""),col = "yellow")
```

# Final Checks on the Model (part 2)
```{r echo=FALSE}
par(mfrow = c(1, 1))
#Homorskedasticity
plot(fitted(final_model), residuals(final_model), main = "(c)",
     xlab = expression(hat(Y)), ylab = "Residuals")
abline(h = 0, col = "gray", lwd = 2,lty = 2)
```

# Final Checks on the Model (part 3)
```{r echo=FALSE}
par(mfrow = c(1, 1))
#Normality
qqnorm(residuals(final_model), main = "(d)")
qqline(residuals(final_model), col = "blue", lwd = 2)
```

# Final Checks on the Model (part 4)
```{r echo=FALSE}
hist(residuals(final_model), main = "(e)", xlab = "Residuals")
```



# Final Checks on the Model (part 5)
```{r echo=FALSE}
par(mfrow = c(1, 1))
#Independence of error terms
plot(residuals(final_model), type = "l", col = "blue", main = "(f)", ylab = "Residuals")
par(mfrow = c(1, 1))
```


# Final Checks on the Model (part 6)
```{r echo=FALSE}
#Validate the model
predict(final_model, data.frame(price = 2.179, discount = 1, promotion = 0),
        level = 0.95, interval = "prediction")
print("Actual value: 2.69")
cat("\n")
cat("\n")

predict(final_model, data.frame(price = 2.260, discount = 0, promotion = 1),
        level = 0.95, interval = "prediction")
print("Actual value: 2.42")
cat("\n")
cat("\n")
```

# Final Checks on the Model (part 7)
```{r echo=FALSE}
predict(final_model, data.frame(price = 2.248, discount = 0, promotion = 0),
        level = 0.95, interval = "prediction")
print("Actual value: 2.45")
cat("\n")

predict(final_model, data.frame(price = 2.557, discount = 1, promotion = 0),
        level = 0.95, interval = "prediction")
print("Actual value: 2.72")
cat("\n")
```

# Final Checks on the Model (part 8)
```{r}
#Check p-score
p_score <- coeftest(final_model)

abs(p_score[2,4]) <= 0.05
abs(p_score[3,4]) <= 0.05
abs(p_score[4,4]) <= 0.05
```


# General Discussion and Conclusions (part 1)
```{r echo=FALSE}
cat("YÌ‚ = ", round(coefficients(final_model)[1], 2), 
      "+", round(coefficients(final_model)[2], 2), "X1", 
      "+", round(coefficients(final_model)[3], 2), "X2",
      "+", round(coefficients(final_model)[4], 2), "X3")
```

- Yhat is the market share
- X1 would be the price
- X2 would be whether there was a discount
- X3 would be whether there was a promotion

# General Discussion and Conclusions (part 2)
- Different tests and checks like residual plots, Cook's Distance, and homorskedasticity were checked
- The model also predicted some of the values in the data accurately
- Price of the product, offered discounts, and potential promotions impact the market share